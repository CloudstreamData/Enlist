<?xml version="1.0" encoding="UTF-8"?>
<!--

    Enlist - Volunteer Management Software
    Copyright (C) 2011 GreatBizTools, LLC

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
    
    Linking this library statically or dynamically with other modules is
    making a combined work based on this library.  Thus, the terms and
    conditions of the GNU General Public License cover the whole
    combination.

$Id: $

Notes:
-->

<!DOCTYPE mach-ii PUBLIC "-//Mach-II//DTD Mach-II Configuration 1.9.0//EN"
	"http://www.mach-ii.com/dtds/mach-ii_1_9_0.dtd" >

<mach-ii version="1.9">

	<!-- MODULES -->
	<modules>
		<module name="dashboard" file="/MachII/dashboard/config/mach-ii_dashboard.xml">
			<mach-ii>
				<properties>
					<property name="password" value="enlist"/>
					<property name="enableLogin">
						<struct>
							<key name="group:development" value="false"/>
							<key name="group:production" value="true"/>
						</struct>
					</property>
					<property name="logoutPromptTimeout">
						<struct>
							<key name="group:production" value="10"/>							
						</struct>
					</property>
				</properties>
			</mach-ii>
		</module>
	</modules>

	<!-- INCLUDES -->
	<includes>
	</includes>
	
	<!-- PROPERTIES -->
	<properties>
		<property name="applicationRoot" value="/Enlist" />
		<property name="defaultEvent" value="home" />
		<property name="eventParameter" value="event" />
		<property name="parameterPrecedence" value="form" />
		<property name="maxEvents" value="10" />
		<property name="exceptionEvent" value="sys.exception" />
		<property name="urlBase" value="/index.cfm" />
		<property name="urlParseSES" value="true"/>
		<property name="urlDelimiters" value="/|/|/"/>
		<property name="urlExcludeEventParameter" value="true"/>

	<!-- Begin APPLICATION -->
		<property name="Environment" type="MachII.properties.EnvironmentProperty">
			<parameters>
				<parameter name="defaultEnvironmentName" value="production"/>
				<parameter name="development">
					<struct>
						<key name="environmentGroup" value="development"/>
						<key name="servers" value="localhost"/>
						<key name="properties">
							<struct>
								<key name="modules:lazyLoad" value="*"/>
							</struct>
						</key>
					</struct>
				</parameter>
				<parameter name="production">
					<struct>
						<key name="environmentGroup" value="production"/>
						<key name="servers" value="enlist.appspot.com"/>
						<key name="properties">
							<struct>
								<key name="modules:disable" value="dashboard"/>
							</struct>
						</key>
					</struct>
				</parameter>
			</parameters>
		</property>

		<property name="coldspring" type="MachII.properties.ColdspringProperty">
			<parameters>
				<parameter name="beanFactoryPropertyName" value="serviceFactory"/>
				<parameter name="configFile" value="/Enlist/config/services.xml"/>
				<parameter name="configFilePathIsRelative" value="true"/>
				<parameter name="placeFactoryInApplicationScope" value="true"/>
				<parameter name="generateRemoteProxies" value="true"/>
				<parameter name="resolveMachIIDependencies" value="true"/>
				<!-- Struct of bean names and corresponding Mach-II property names for injecting back into Mach-II Default: does nothing if struct is not defined -->
				<parameter name="beansToMachIIProperties">
					<struct>
						<key name="udfs" value="udfs" />
						<key name="googleUserService" value="googleUserService" />
					</struct>
				</parameter>
			</parameters>
		</property>
		
		<property name="html" type="MachII.properties.HtmlHelperProperty">
			<parameters>
				<parameter name="metaTitleSuffix" value=" | Enlist" />
				<parameter name="cacheAssetPaths">
					<struct>
						<key name="development" value="true" />
						<key name="production" value="true" />
					</struct>
				</parameter>
				<parameter name="assetPackages">
					<struct>
						<key name="jquery">
							<array>
								<element value="libraries/jquery/jquery-1-5.js" />
								<element value="libraries/jquery/jquery-ui-1.8.9.custom.min.js" />
							</array>
						</key>
					</struct>
				</parameter>
			</parameters>
		</property>
		
		<!-- CACHING RELATED -->
		<property name="caching" type="MachII.caching.CachingProperty" />
		
		<!-- LOGGING RELATED -->
		<property name="Logging" type="MachII.logging.LoggingProperty">
			<parameters>
				<parameter name="loggingEnabled">
					<struct>
						<key name="group:development" value="true" />
						<key name="group:production" value="false" />
					</struct>
				</parameter>
			</parameters>
		</property>
	</properties>

	<!-- LISTENERS -->
	<listeners>
	  <listener name="ActivityListener" type="Enlist.controllers.listeners.ActivityListener" />
		<!--
		<listener name="yourListenerName" type="fully.Qualified.Dot.Delimited.Path.To.CFC">
			<parameters>
				<parameter name="yourParameterName" value="yourParameterValue" />
			</parameters>
		</listener>
		-->
	</listeners>
	
	<!-- MESSAGE SUBSCRIBERS -->
	<message-subscribers>
		<!-- see the messagePublisher event handler below for an example of what would call this -->
		<!--
		<message name="needStuff" multithreaded="true" waitForThreads="true" timeout="10">
			<subscribe listener="listener1" method="method1" resultArg="stuff1" />
			<subscribe listener="listener2" method="method2" resultArg="stuff2" />
		</message>
		-->
	</message-subscribers>
	
	<!-- EVENT-FILTERS -->
	<event-filters>
		<!--
		<event-filter name="yourEventFilterName" type="fully.Qualified.Dot.Delimited.Path.To.CFC">
			<parameters>
				<parameter name="yourParameterName" value="yourParameterValue" />
			</parameters>
		</event-filter>
		-->
	</event-filters>

	<!-- PLUGINS -->
	<plugins>
		<plugin name="application" type="Enlist.controllers.plugins.ApplicationPlugin"/>
	</plugins>

	<!-- EVENT-HANDLERS -->
	<event-handlers>
		<!-- BASE -->
		<event-handler event="home" access="public">
			<view-page name="home" contentArg="layout.content" />
			<execute subroutine="doMainLayout" />
		</event-handler>
		<event-handler event="register" access="public">
			<event-bean name="user" type="Enlist.model.user.User" />
			<call-method bean="chapterService" method="getChapters" resultArg="chapters" />
			<view-page name="register" contentArg="layout.content" />
			<execute subroutine="doMainLayout" />
		</event-handler>
		<event-handler event="register_process" access="public">
			<event-bean name="user" type="Enlist.model.user.User" autopopulate="true" reinit="false"  />
			<call-method bean="userService" method="saveUser">
				<arg name="user" value="${event.user}" />
			</call-method>
			<event-arg name="message" value="Registration saved" />
			<view-page name="home" contentArg="layout.content"/>
			<execute subroutine="doMainLayout"/>
		</event-handler>
		<event-handler event="logout" access="public">
			<call-method bean="sessionFacade" method="removeUser" />
		</event-handler>
		
		
		<!-- VOLUNTEER -->
		
		
		<!-- ADMIN -->
		<event-handler event="admin.index" access="public">
			<view-page name="admin.index" contentArg="layout.content"/>
			<execute subroutine="doMainLayout"/>
		</event-handler>
		
		<!-- EVENTS -->
		<event-handler event="event.list" access="public">
			<call-method bean="eventService" method="getEvents" resultArg="events" />
			<view-page name="event.list" contentArg="layout.content"/>
			<execute subroutine="doMainLayout"/>
		</event-handler>
		<event-handler event="event.edit" access="public">
			<call-method bean="eventService" method="getEvent" resultArg="event">
				<arg name="eventID" value="${event.id:''}" />
			</call-method>
			<view-page name="event.edit" contentArg="layout.content"/>
			<execute subroutine="doMainLayout"/>
		</event-handler>
		<event-handler event="event.save" access="public">
			<call-method bean="eventService" method="getEvent" resultArg="event">
				<arg name="eventID" value="${event.id}" />
			</call-method>
			<event-bean name="event" type="Enlist.model.event.Event" autopopulate="true" reinit="false"  />
			<call-method bean="eventService" method="saveEvent">
				<arg name="event" value="${event.event}" />
			</call-method>
			<event-arg name="message" value="Event saved" />
			<view-page name="event.edit" contentArg="layout.content"/>
			<execute subroutine="doMainLayout"/>
		</event-handler>
		
		<!-- ACTIVITIES -->
		<event-handler event="activity.list" access="public">
			<call-method bean="ActivityService" method="getActivities" resultArg="activities" />
			<view-page name="activity.list" contentArg="layout.content"/>
			<execute subroutine="doMainLayout"/>
		</event-handler>
		
		<!-- CHAPTERS -->
		<event-handler event="chapter.list" access="public">
			<call-method bean="chapterService" method="getChapters" resultArg="chapters" />
			<view-page name="chapter.list" contentArg="layout.content"/>
			<execute subroutine="doMainLayout"/>
		</event-handler>
		<event-handler event="chapter.edit" access="public">
			<call-method bean="chapterService" method="getChapter" resultArg="chapter">
				<arg name="chapterID" value="${event.id:''}" />
			</call-method>
			<view-page name="chapter.edit" contentArg="layout.content"/>
			<execute subroutine="doMainLayout"/>
		</event-handler>
		<event-handler event="chapter.save" access="public">
			<call-method bean="chapterService" method="getChapter" resultArg="chapter">
				<arg name="chapterID" value="${event.id}" />
			</call-method>
			<event-bean name="chapter" type="Enlist.model.chapter.Chapter" autopopulate="true" reinit="false"  />
			<call-method bean="chapterService" method="saveChapter">
				<arg name="chapter" value="${event.chapter}" />
			</call-method>
			<event-arg name="message" value="Chapter saved" />
			<view-page name="chapter.edit" contentArg="layout.content"/>
			<execute subroutine="doMainLayout"/>
		</event-handler>
		
		<!-- SYS -->
		<event-handler event="sys.about" access="public">
			<view-page name="sys.about" contentArg="layout.content"/>
			<execute subroutine="doMainLayout"/>
		</event-handler>
		<event-handler event="sys.exception" access="private">
			<view-page name="sys.exception" contentArg="layout.content"/>
			<execute subroutine="doMainLayout"/>
		</event-handler>
	</event-handlers>
	
	<!-- SUBROUTINES -->
	<subroutines>
		<subroutine name="doMainLayout">
			<view-page name="layout.header" contentArg="layout.header" />
			<view-page name="layout.footer" contentArg="layout.footer" />
			<view-page name="layout.wrapper" />
		</subroutine>
	</subroutines>
	
	<!-- PAGE-VIEWS -->
	<page-views>
		<view-loader type="PatternViewLoader" />
	</page-views>
	
</mach-ii>